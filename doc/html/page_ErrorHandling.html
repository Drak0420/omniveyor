<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Omniveyor: Safety: Three Layers of Error Handling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Omniveyor
   </div>
   <div id="projectbrief">Root Repository for the OmniVeyor Robots</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Safety: Three Layers of Error Handling </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>If one the methods<br  />
<br  />
</p><ul>
<li><a class="el" href="classReflexxesAPI.html#a30d3cdba072553a5d53aa4ce4b4a77d1" title="This is the central method of each Reflexxes Type Motion Library.">ReflexxesAPI::RMLPosition()</a> or<br  />
<br  />
</li>
<li><a class="el" href="classReflexxesAPI.html#aaf2478f04265b6a6ac04b1b218a30678" title="This is the method for velocity-based On-Line Trajectory Generation.">ReflexxesAPI::RMLVelocity()</a><br  />
<br  />
 is called with valid input values, it is <b>guaranteed</b> that the output values of the Reflexxes algorithms lead to a <b>continuous acceleration-limited motion trajectory in any case</b>. This fundamental feature was implemented using a three-layered approach of error-handling, which is described in the following two sections.<br  />
<br  />
</li>
</ul>
<ol type="1">
<li>sec_ErrorHandlingPositionBased<br  />
<br  />
</li>
<li>sec_ErrorHandlingVelocityBased<br  />
<br  />
</li>
</ol>
<p><br  />
 </p><hr  />
<h1><a class="anchor" id="sec_ErrorHandlingPositionBased"></a>
Error-Handling for the Position-based On-Line Trajectory Generation Algorithm</h1>
<p>The position-based Reflexxes Type II On-Line Trajectory Generation (<a class="el" href="classOTG.html">OTG</a>) algorithm is the most complex algorithm of the Reflexxes Motion Libraries. Robustness and numerical stability are key features to assure deterministic and safe behaviors of robots and mechanical systems. After more than eight years of research and development, the released algorithm runs robust and is numerically stable.</p>
<p>In order to guarantee continuous acceleration-limited motion trajectories, three layers of error-handling have been implemented in order to obtain a deterministic and safe behavior of all Reflexxes Motion Libraries for any set given input values.</p>
<p><br  />
 </p><div class="image">
<img src="ThreeSafetyLayers.png" alt=""/>
<div class="caption">
Three layers of safety and error-handling for the position-based On-Line Trajectory Generation algorithm.</div></div>
<p><br  />
 </p>
<h2><a class="anchor" id="ssec_Layer3Position"></a>
Layer 3</h2>
<p>This layer contains the position-based Reflexxes Type II On-Line Trajectory Generation algorithm. This algorithm is called through the API method <a class="el" href="classReflexxesAPI.html#a30d3cdba072553a5d53aa4ce4b4a77d1" title="This is the central method of each Reflexxes Type Motion Library.">ReflexxesAPI::RMLPosition()</a>, which calls the internal method <a class="el" href="classTypeIIRMLPosition.html#af2a8f0d8c55c3f5a4861149a7bc35d66" title="The main method of the class TypeIIRMLPosition. It executes the position-based Type II On-Line Trajec...">TypeIIRMLPosition::GetNextStateOfMotion()</a> that contains the actual position-based trajectory generation algorithm. If the algorithm is fed with valid input values, that is, the method <a class="el" href="classRMLPositionInputParameters.html#a8a36aa4df4c86606a1d47f204cb901a3" title="Checks the input parameters for validity.">RMLPositionInputParameters::CheckForValidity()</a> returns <code>false</code>, we switch from <em>Layer 3</em> to <em>Layer 2</em> (even after after more than <img class="formulaInl" alt="$ 10^{11} $" src="form_24.png"/> cylces, this has not happened yet).</p>
<p>The implementation of <em>Layer 2</em> can be found in the method <a class="el" href="classTypeIIRMLPosition.html#a3077401a1e960822fef142d3cfddd21b" title="In case of an error, this method triggers the second layer of the safety concept.">TypeIIRMLPosition::FallBackStrategy()</a>.</p>
<h2><a class="anchor" id="ssec_Layer2Position"></a>
Layer 2</h2>
<p>In the second layer, the velocity-based algorithm of the Reflexxes Type II Motion Library is executed in order to safely transfer the system to a predefined velocity (cf. <a class="el" href="classReflexxesAPI.html#aaf2478f04265b6a6ac04b1b218a30678" title="This is the method for velocity-based On-Line Trajectory Generation.">ReflexxesAPI::RMLVelocity()</a>). The default value for this alternative desired velocity vector <img class="formulaInl" alt="$ \vec{V}_{i}^{\,\underline{trgt}} $" src="form_25.png"/> is zero, that is, the robot or mechanical system would simply slow down to zero-velocity by using the currently given maximum acceleration vector <img class="formulaInl" alt="$ \vec{A}_i^{\,max} $" src="form_26.png"/> (cf. <a class="el" href="classRMLInputParameters.html#af9c1e6649468c56e9d7f53cf71c9f55d" title="A pointer to the maximum acceleration vector .">RMLPositionInputParameters::MaxAccelerationVector</a>) until <img class="formulaInl" alt="$ \vec{V}_{i}^{\,\underline{trgt}}\ =\ \vec{0}$" src="form_27.png"/> is reached. In order to decouple all selected degrees of freedom and to reach this sate safely, a non-synchronized motion will be computed, and the flag <a class="el" href="classRMLFlags.html#ac81441080dcaa610ff37c395ffc0bd5ea1139782c92cf4c4cd0b13fc049661b00" title="No synchronization will be performed, and all selected degrees of freedom are treated independently.">RMLFlags::NO_SYNCHRONIZATION</a> will be used for the velocity-based algorithm.</p>
<p>If it is not desired to decrease the velocity to zero but to continue moving the system with a certain application- or task-dependent velocity, an alternative desired target velocity vector <img class="formulaInl" alt="$ \vec{V}_{i}^{\,\underline{trgt}} $" src="form_25.png"/> can be defined. The attribute <a class="el" href="classRMLPositionInputParameters.html#a04d8c3135843bae93cbf7b8cbab8d819" title="A pointer to an alternative target velocity vector .">RMLPositionInputParameters::AlternativeTargetVelocityVector</a> can be used to specify this alternative velocity vector unequal to zero, <img class="formulaInl" alt="$ \vec{V}_{i}^{\,\underline{trgt}}\ \neq\ \vec{0}$" src="form_28.png"/>. Furthermore, the input flag <a class="el" href="classRMLPositionFlags.html#aeb8be0d5bdaffa0384f2c9915c5134a1" title="If true, RMLPositionInputParameters::AlternativeTargetVelocityVector will be used in TypeIVRMLPositio...">RMLPositionFlags::KeepCurrentVelocityInCaseOfFallbackStrategy</a> can be used to set the alternative desired target velocity vector to the current velocity vector, that is, <img class="formulaInl" alt="$ \vec{V}_{i}^{\,\underline{trgt}}\ =\ \vec{V}_i$" src="form_29.png"/>.</p>
<p>The mathematical equations of the velocity-based On-Line Trajectory Generation only contain closed-form solutions; numerical instabilities cannot occur if the <a class="el" href="page_InputValues.html#sec_NumericalStability">Input Requirements for Numerical Stability</a> are met. In case, the user specifies elements of the maximum acceleration vector <img class="formulaInl" alt="$ \vec{A}_i^{\,max} $" src="form_26.png"/> that are equal or less than zero (cf. <a class="el" href="classRMLInputParameters.html#af9c1e6649468c56e9d7f53cf71c9f55d" title="A pointer to the maximum acceleration vector .">RMLPositionInputParameters::MaxAccelerationVector</a>), the algorithm will even switch from <em>Layer 2</em> to <em>Layer 1</em> in order to continue the current motion. This layer is implemented in the method <a class="el" href="classTypeIIRMLVelocity.html#a4ed81db3cc17aab8e52795386b5ce07d" title="In case of an error, this method triggers the next layer of the safety concept.">TypeIIRMLVelocity::FallBackStrategy()</a>.</p>
<h2><a class="anchor" id="ssec_Layer1Position"></a>
Layer 1</h2>
<p>Although even the probability of switching from <em>Layer 3</em> to <em>Layer 2</em> can only happen in case of incorrect input values, a third layer is used to handle this case. In this case, the motion of the system is continued with zero-acceleration. That means the output values <a class="el" href="classRMLPositionOutputParameters.html" title="Class for the output parameters of the position-based On-Line Trajectory Generation algorithm.">RMLPositionOutputParameters</a> determined by the following equations:</p>
<p class="formulaDsp">
<img class="formulaDsp" alt="\[ \begin{array}{rrcl} \forall\ k\ \in\ \left\{1,\,\dots,\,K\right\}:\ \ \ \ &amp;_{k}P_{i+1}&amp;\ =\ &amp;_{k}P_{i}\ +\ _{k}V_{i}\,T^{\,cycle}\\[3ex] &amp;_{k}V_{i+1}&amp;\ =\ &amp;_{k}V_{i}\\[3ex] \end{array} \]" src="form_30.png"/>
</p>
<p> Where the variables and symbols represent the following data:<br  />
<br  />
</p><ul>
<li><img class="formulaInl" alt="$ K $" src="form_31.png"/> is the number of degrees of freedom of the system<br  />
<br  />
</li>
<li><img class="formulaInl" alt="$ T^{\,cycle} $" src="form_32.png"/> is the cycle time given in seconds<br  />
<br  />
</li>
<li><img class="formulaInl" alt="$ _{k}P_{i} $" src="form_33.png"/> is the position of the degree of freedom <img class="formulaInl" alt="$ k $" src="form_19.png"/> at time instant <img class="formulaInl" alt="$ T_i $" src="form_34.png"/><br  />
<br  />
</li>
<li><img class="formulaInl" alt="$ _{k}V_{i} $" src="form_35.png"/> is the velocity of the degree of freedom <img class="formulaInl" alt="$ k $" src="form_19.png"/> at time instant <img class="formulaInl" alt="$ T_i $" src="form_34.png"/><br  />
<br  />
</li>
<li><img class="formulaInl" alt="$ _{k}P_{i+1} $" src="form_36.png"/> is the position of the degree of freedom <img class="formulaInl" alt="$ k $" src="form_19.png"/> at time instant <img class="formulaInl" alt="$ T_{i+1} $" src="form_37.png"/><br  />
<br  />
</li>
<li><img class="formulaInl" alt="$ _{k}V_{i+1} $" src="form_38.png"/> is the velocity of the degree of freedom <img class="formulaInl" alt="$ k $" src="form_19.png"/> at time instant <img class="formulaInl" alt="$ T_{i+1} $" src="form_37.png"/><br  />
<br  />
</li>
<li>The time difference from one control cycle at <img class="formulaInl" alt="$ T_{i} $" src="form_39.png"/> to the next control cycle at <img class="formulaInl" alt="$ T_{i+1} $" src="form_37.png"/> is <img class="formulaInl" alt="$ T^{\,cycle} $" src="form_32.png"/>, that is <img class="formulaInl" alt="$ T_{i+1}\ -\ T_{i}\ =\ T^{\,cycle} $" src="form_40.png"/>.<br  />
<br  />
 Details about the implementation of these equations can be found in the method <a class="el" href="classTypeIIRMLVelocity.html#a4ed81db3cc17aab8e52795386b5ce07d" title="In case of an error, this method triggers the next layer of the safety concept.">TypeIIRMLVelocity::FallBackStrategy()</a>.</li>
</ul>
<p><br  />
 </p>
<h2><a class="anchor" id="ssec_RemarkPhaseSynchronizationPosition"></a>
Remark on Phase-Synchronized Trajectories</h2>
<p>If a phase-synchronized motion trajectory is required (i.e., the input flag <a class="el" href="classRMLFlags.html#ac81441080dcaa610ff37c395ffc0bd5ea4386bfe9c6eea47eaeaa7956a06774e0" title="Only phase-synchronized trajectories are allowed. If it is not possible calculate a phase-synchronize...">RMLPositionFlags::ONLY_PHASE_SYNCHRONIZATION</a> is set), and if phase-synchronisation is not possible because the input vectors are not collinear, we also switch from <em>Layer 3</em> to <em>Layer 2</em>, because in this case, priority is given to the fact that phase-synchronization is required (otherwise, the flag <a class="el" href="classRMLFlags.html#ac81441080dcaa610ff37c395ffc0bd5ea9f1e40a21dd62dbfb2413ef1d429547d" title="This is the default value. If it is possible to calculate a phase-synchronized (i....">RMLPositionFlags::PHASE_SYNCHRONIZATION_IF_POSSIBLE</a> may be used). If we switch to the second layer in this case, the algorithm will check, whether a phase-synchronous solution is existent if the velocity-based On-Line Trajectory Generation is executed. If so, the velocity-based algorithm will compute a phase-synchronized motion. Otherwise, we will switch from <em>Layer 2</em> to <em>Layer 1</em>. If the current state of motion is homothetic, the trajectory will be continued homothetically (phase-synchronized) by applying zero-acceleration in the current control cycle.</p>
<p><br  />
 </p><hr  />
<h1><a class="anchor" id="sec_ErrorHandlingVelocityBased"></a>
Error-Handling for the Velocity-based On-Line Trajectory Generation Algorithm</h1>
<p>The velocity-based Reflexxes Type II On-Line Trajectory Generation (<a class="el" href="classOTG.html">OTG</a>) algorithm is of much simpler nature than the position-based algorithm and only a two-layered method is used for error-handling. This safety mechanism is directly derived from <em>Layer 2</em> and <em>Layer 1</em> of the position-based On-Line Trajectory Generation algorithm.</p>
<p><br  />
 </p><div class="image">
<img src="ThreeSafetyLayersVelocity.png" alt=""/>
<div class="caption">
Two layers of safety and error-handling for the velocity-based On-Line Trajectory Generation algorithm.</div></div>
<p><br  />
 The algorithm is called through the API method <a class="el" href="classReflexxesAPI.html#aaf2478f04265b6a6ac04b1b218a30678" title="This is the method for velocity-based On-Line Trajectory Generation.">ReflexxesAPI::RMLVelocity()</a>, which executes the internal method <a class="el" href="classTypeIIRMLVelocity.html#aa9725881ff7c9355cfd1c4446cff0ffc" title="The main method of the class TypeIIRMLVelocity. It executes the velocity-based Type II On-Line Trajec...">TypeIIRMLVelocity::GetNextStateOfMotion()</a>. If the input values for this algorithm are valid, that is, the result of <a class="el" href="classRMLVelocityInputParameters.html#a73ad2f505ef37bef4a8b3b8fdbae95b2" title="Checks the input parameters for validity.">RMLVelocityInputParameters::CheckForValidity()</a> is <code>true</code>, the velocity-based algorithm will always find the correct solution. If <a class="el" href="classRMLVelocityInputParameters.html#a73ad2f505ef37bef4a8b3b8fdbae95b2" title="Checks the input parameters for validity.">RMLVelocityInputParameters::CheckForValidity()</a> returns <code>false</code>, because elements of the maximum acceleration vector <img class="formulaInl" alt="$ \vec{A}_i^{\,max} $" src="form_26.png"/> that or equal or less than zero (cf. <a class="el" href="classRMLInputParameters.html#af9c1e6649468c56e9d7f53cf71c9f55d" title="A pointer to the maximum acceleration vector .">RMLVelocityInputParameters::MaxAccelerationVector</a> and <a class="el" href="classRMLInputParameters.html#a5968ce643868260410f149996c446b66" title="A pointer to the maximum jerk vector .">RMLVelocityInputParameters::MaxJerkVector</a>), the algorithm will switch from <em>Layer 2</em> to <em>Layer 1</em> in order to continue the current motion. This layer is implemented in the method <a class="el" href="classTypeIIRMLVelocity.html#a4ed81db3cc17aab8e52795386b5ce07d" title="In case of an error, this method triggers the next layer of the safety concept.">TypeIIRMLVelocity::FallBackStrategy()</a>. Please refer to Sec. <a class="el" href="page_ErrorHandling.html#ssec_Layer1Position">Layer 1</a> of the position-based algorithm for a detailed description.</p>
<p><br  />
 </p>
<h2><a class="anchor" id="ssec_RemarkPhaseSynchronizationVelocity"></a>
Remark on Phase-Synchronized Trajectories</h2>
<p>If a phase-synchronized motion trajectory is required (i.e., the input flag <a class="el" href="classRMLFlags.html#ac81441080dcaa610ff37c395ffc0bd5ea4386bfe9c6eea47eaeaa7956a06774e0" title="Only phase-synchronized trajectories are allowed. If it is not possible calculate a phase-synchronize...">RMLVelocityFlags::ONLY_PHASE_SYNCHRONIZATION</a> is set), and if phase-synchronisation is not possible because the input vectors are not collinear, we also apply the switching mechanism described above (i.e., the new state of motion is computed by applying a zero-acceleration). If the current state of motion is homothetic, the trajectory will be continued homothetically (phase-synchronized).</p>
<p><br  />
<br  />
</p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
