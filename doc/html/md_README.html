<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Omniveyor: OmniVeyors</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Omniveyor
   </div>
   <div id="projectbrief">Root Repository for the OmniVeyor Robots</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">OmniVeyors </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Root Repository for the OmniVeyor Robots.</p>
<h1><a class="anchor" id="autotoc_md26"></a>
Robot configuration</h1>
<h3><a class="anchor" id="autotoc_md27"></a>
Hardware Setup</h3>
<ul>
<li>Remove top panel and rear panel.</li>
<li>Remove UPS and short the two pairs of wires with two connection blocks (+ with +, - with -)</li>
<li>Install SSD and PCI-e to USB 3.0 card inside the robot computer. Remove the dedicated graphics card to make room for the USB 3.0 card.</li>
<li>Install Hokuyo UST-10LX LiDAR, Power the LiDAR from terminals (+12V and GND).</li>
<li>Install Arduino and custom function button. Button connects to Pin D8 and GND. LED on the button (5V) connects to D11 and GND.</li>
<li>Install wireless charger. The receiver side of the charger has two power lines and three signal lines. Connect Power Red to Battery + (red), Power Black to Battery - (black). Connect Signal Brown (Control) to Arduino D12, Signal Yellow (Fault) to Arduino D13, and Signal Blue (GND) to Arduino GND.</li>
<li>Check and set servo motor IDs. Front Right Steer - 1, Front Right Roll - 2, Front Left Steer - 3, Front Left Roll - 4, ..., Rear Right Roll - 8.</li>
<li>Install RealSense Cameras. Front Left: D435i. Front Right: T265. Rear Right: D435i (optional). Connect the USB cables to the USB 3.0 card. From left to right the order is: T265, No Connection, Rear D435i, Front D435i.</li>
</ul>
<h3><a class="anchor" id="autotoc_md28"></a>
Install Linux System</h3>
<p>Recommended: <code>Lubuntu 20.04</code> or <code>Kubuntu 20.04</code>.</p>
<p>LXQt / KDE + SDDM uses significantly less RAM and CPU resources than the default Gnome desktop in Ubuntu 20.04.</p>
<p><em>Specific to the ADLink MXC6300 machine on the robot</em></p><ul>
<li>Pre-installation: Hold <code>Del</code> key to enter BIOS. Find Advanced &gt; Advanced Power Management &gt; Restore AC Power Loss. Set to <code>Power On</code>.</li>
<li>Find Chipset &gt; Primary IGFX Boot Display. Set to <code>DP1</code>. Then find Active LFP and set to <code>Int-LVDS</code>. Set the LCD Panel Type to the desired resolution resolution (<code>1920x1080 LVDS</code> for example). This option creates a virtual screen for graphical display when the robot is running headless.</li>
<li>Insert installation media. Press <code>F4</code> key to Save and Reset.</li>
<li>Installation: Hold <code>Del</code> to enter BIOS. In the Save and Exit tab, find the installation media and override boot order.</li>
<li>Enter live session and install system. In case the virtual screen is recognized as the main screen and you see a blank desktop, use the following key order to invoke monitor setting: <code>Windows</code>, <code>m</code>, <code>o</code>, <code>n</code>, <code>up</code>, <code>Enter</code> In the opened window select <code>Unified View</code>.</li>
</ul>
<h3><a class="anchor" id="autotoc_md29"></a>
Setup Linux System</h3>
<ul>
<li>This section assumes you have already installed Lubuntu 20.04, or equivalent flavors with SDDM desktop manager.</li>
<li>Clone this repository to <code>~/Dev</code>, for example: <div class="fragment"><div class="line">mkdir -p ~/Dev/ros_ws/src</div>
<div class="line">cd ~/Dev/ros_ws/src</div>
<div class="line">git clone https://github.com/HaoguangYang/omniveyor.git</div>
</div><!-- fragment --></li>
<li><b>In the <code>ros_ws</code> folder</b>, run the all-in-one <a href="https://github.com/HaoguangYang/omniveyor/blob/master/systemInitialSetup.sh">setup script</a>: <div class="fragment"><div class="line">cd ..; ./src/omniveyor/systemInitialSetup.sh</div>
</div><!-- fragment --></li>
<li>Sit back and relax!</li>
</ul>
<h3><a class="anchor" id="autotoc_md30"></a>
File Structure</h3>
<div class="fragment"><div class="line">ros_ws/src/</div>
<div class="line">      |---omniveyor &lt;This repository&gt;</div>
<div class="line">      |   |---omniveyor_mobility (High-level package for mapping, localization, and navigation)</div>
<div class="line">      |   |---spatio_temporal_voxel_layer (MoveBase plugin for spatio voxel cloud generation and obstacle avoidance)</div>
<div class="line">      |   ----nimbro_network (Multi ROS master communication infrastructure)</div>
<div class="line">      |---omniveyor_common (Common definitions, message types, and definitions across hardware and simulator)</div>
<div class="line">      |---omniveyor_hardware</div>
<div class="line">      |   |---pcv_base (Robot base driver)</div>
<div class="line">      |   |---&lt;Placeholder for future hardware&gt;</div>
<div class="line">      |   ----robot_localization (Odometer filtering tools -- EKF, UKF, etc.)</div>
<div class="line">      ----omniveyor_simulator</div>
<div class="line">          |---omniveyor_gazebo_world (Robot simulator main)</div>
<div class="line">          ----realsense_ros_gazebo (Plugin for Realsense simulation)</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md31"></a>
Debugging and Troubleshooting</h3>
<ul>
<li><p class="startli">To debug CAN bus, use candump: </p><div class="fragment"><div class="line">candump -ax can0</div>
</div><!-- fragment --><p class="startli">The documentation for the iPOS motor controller CAN protocol can be found <a href="http://www.technosoft.ro/KB/index.php?/getAttach/46/AA-15445/P091.063.CANopen.iPOS.UM.pdf">HERE</a>.</p>
</li>
<li>If canbus keeps dropping frames, may need to manually address QoS strategy in <code>/etc/systemd/system/canbus.service</code>: <div class="fragment"><div class="line"># change congestion control method for CAN0 to ensure data packets are not stale under congestion.</div>
<div class="line">ExecStartPre=... &amp;&amp; tc qdisc add dev can0 root handle 1: pfifo_head_drop limit 9</div>
</div><!-- fragment --></li>
<li><p class="startli">If you are using Gnome desktop manager, comment out the <code>x11vnc</code> section of the <code>./systemInitialSetup.sh</code> script, and use the inbuilt Vino server instead. The VNC server is started through Settings &gt; Sharing &gt; Desktop Sharing.</p>
<p class="startli"><em>Optional</em> enable access of VNC through Windows machines by turning off encryption (<b>NO sudo</b>): </p><div class="fragment"><div class="line">gsettings set org.gnome.Vino require-encryption false</div>
</div><!-- fragment --></li>
<li>If WiFi dongle works below expectation, you may try to use third-party driver, e.g. <a href="https://github.com/aircrack-ng/rtl8188eus">Aircrack-ng's RTL 8188EUS driver</a> for better WiFi connection.</li>
<li><code>qterminal</code> may be swapped by <code>xterm</code> in some occasions during the installation of <code>ros-noetic-fkie-multimaster</code>. If you feel uncomfortable, do: <div class="fragment"><div class="line">sudo mv /usr/bin/xterm /usr/bin/xterm.old &amp;&amp; sudo ln -s /usr/bin/qterminal /usr/bin/xterm</div>
</div><!-- fragment --></li>
<li><p class="startli"><b>Deprecated, Use with Caution</b> This repository includes a bootup script, such that the SSH and VNC ports of the cart are mapped to a Virtual Private Server with static IP. To enable the automatic bootup sequence, add the following line in <code>crontab -e</code>: </p><div class="fragment"><div class="line">@reboot sleep 30; cd /home/cartman/Dev/Mobile_Manipulation_Dev/; sh ./onBoot.sh</div>
</div><!-- fragment --><p class="startli"><b>WARNING:</b> The program will run 30s after the machine is booted up. Plugging in a joystick will mobilize the robot. Refer to <code>autorun.py</code> (under <code>src/pcv_base/scripts</code>) for series of commands it executes.</p>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md32"></a>
Compile and run the code:</h3>
<div class="fragment"><div class="line">catkin_make -DCMAKE_BUILD_TYPE=Release</div>
</div><!-- fragment --><p>Then run the ros package <code>pcv_base</code>.</p>
<p><b>Deprecated</b> Automatic run procedure is defined in the autorun.py, which structures a move of the robot as a "task", as defined in the <code>pcv_base/scripts</code> folder: </p><div class="fragment"><div class="line">autorun.py --(imports)--&gt; task --(imports)--&gt; payload</div>
<div class="line">                            |----(calls)--&gt; launch</div>
<div class="line">                            |----(uses)--&gt; resources</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md33"></a>
Base Station configuration</h1>
<h3><a class="anchor" id="autotoc_md34"></a>
Connect to the robot with Remote ROS Master</h3>
<div class="fragment"><div class="line">export ROS_MASTER_URI=$Robot_IP_Addr_Here</div>
<div class="line">export ROS_IP=$Your_IP_Here</div>
</div><!-- fragment --><p>If <code>rostopic list</code> works but no message comes through, check <code>ROS_IP</code> or <code>ROS_HOSTNAME</code> setting on the robot side.</p>
<h3><a class="anchor" id="autotoc_md35"></a>
Connect to the robot with &lt;tt&gt;nimbro_network&lt;/tt&gt;</h3>
<p>On the base station side: </p><div class="fragment"><div class="line">roslaunch omniveyor_mobility multi_robot_p2p_onHost.launch</div>
</div><!-- fragment --><p>On the robot side: </p><div class="fragment"><div class="line">roslaunch pcv_base multi_robot_p2p.launch</div>
</div><!-- fragment --><p>WIP</p>
<h1><a class="anchor" id="autotoc_md36"></a>
Simulator Configuration</h1>
<p>WIP </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
